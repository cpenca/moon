<!-- voting.html -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Voting</title>
  <link rel="stylesheet" href="style.css" />

  <style>
    /* Page-specific additions (kept minimal, matches your style system) */
    .card{
      border: var(--border);
      border-radius: var(--radius);
      background: rgba(255,255,255,0.06);
      padding: clamp(18px, 3vw, 26px);
      box-shadow: 0 16px 50px rgba(0,0,0,0.18);
      max-width: 70ch;
    }

    .form-row{
      display:flex;
      gap:12px;
      flex-wrap:wrap;
      margin-top:16px;
      align-items:stretch;
    }

    .field{
      flex:1 1 280px;
      display:flex;
      flex-direction:column;
      gap:8px;
    }

    label{
      font-size: var(--fs-nav);
      color: var(--ink-faint);
    }

    input[type="email"]{
      width:100%;
      padding:14px 16px;
      border-radius: var(--radius);
      border: var(--border);
      background: rgba(0,0,0,0.12);
      color: var(--ink);
      font-size: var(--fs-base);
      outline:none;
    }

    input[type="email"]::placeholder{
      color: rgba(255,255,255,0.65);
    }

    .btn{
      display:inline-flex;
      align-items:center;
      justify-content:center;
      padding:14px 18px;
      border-radius: var(--radius);
      border: var(--border);
      background: rgba(255,255,255,0.14);
      color: rgba(255,255,255,0.92);
      text-decoration:none;
      font-size: var(--fs-nav);
      font-weight:600;
      letter-spacing:0.01em;
      cursor:pointer;
      transition: transform .15s ease, background .15s ease, border-color .15s ease;
      white-space:nowrap;
    }

    .btn:hover{
      transform: translateY(-1px);
      background: rgba(255,255,255,0.22);
      border-color: rgba(255,255,255,0.92);
    }

    .btn:disabled{
      opacity:0.6;
      cursor:not-allowed;
      transform:none;
    }

    .fineprint{
      margin-top:10px;
      font-size:0.95em;
      color: var(--ink-faint);
    }

    .status{
      margin-top:12px;
      min-height:22px;
      color: var(--ink-soft);
    }
    .status.ok{ color: rgba(185,255,218,0.95); }
    .status.err{ color: rgba(255,208,208,0.95); }
  </style>
</head>

<body>
  <header class="site-header container">
    <a class="brand" href="index.html" aria-label="O, Miami home">
      <!-- Update filename if yours is different -->
      <img class="brand-moon moon-bounce" src="moon.png" alt="" />
      <span class="brand-text">, Miami</span>
    </a>
  </header>

  <nav class="site-nav" aria-label="Site navigation">
    <a href="nominations.html">Phase 1: Nominations</a>
    <a href="voting.html" class="cta-primary">Phase 2: Voting</a>
  </nav>

  <main class="container">
    <h1>Voting will open March 1st.</h1>
    <p>If you would like to receive a reminder please join the mailing list.</p>

    <section class="card" aria-label="Mailing list signup">
      <!-- Important: normal form POST (no fetch) avoids Safari “Load failed” / CORS problems -->
      <form id="mailingForm" method="POST" target="hidden_iframe">
        <div class="form-row">
          <div class="field">
            <label for="email">Email address</label>
            <input
              id="email"
              name="email"
              type="email"
              placeholder="you@example.com"
              autocomplete="email"
              required
            />
          </div>

          <button id="submitBtn" class="btn" type="submit">Join mailing list</button>
        </div>

        <div class="fineprint">We’ll only use this to send a voting reminder.</div>
        <div id="status" class="status" role="status" aria-live="polite"></div>

        <!-- Hidden iframe keeps the page from navigating away -->
        <iframe name="hidden_iframe" style="display:none;"></iframe>
      </form>
    </section>
  </main>

  <script>
    // 1) Paste your deployed Google Apps Script Web App URL (the one ending in /exec)
    const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbzH3n5dQ2EVoOLQu7Xpdxg_hIAu9blNzY8RFIkL6cSUyGyIP4OTioUdQbAIUGAIbaC_/exec";

    const form = document.getElementById("mailingForm");
    const emailEl = document.getElementById("email");
    const statusEl = document.getElementById("status");
    const btn = document.getElementById("submitBtn");

    function setStatus(msg, kind){
      statusEl.textContent = msg || "";
      statusEl.className = "status" + (kind ? " " + kind : "");
    }

    // Point the form to Apps Script
    form.action = SCRIPT_URL;

    // Add hidden fields Apps Script reads via e.parameter.*
    function ensureHidden(name, value){
      let el = form.querySelector(`input[name="${name}"]`);
      if (!el){
        el = document.createElement("input");
        el.type = "hidden";
        el.name = name;
        form.appendChild(el);
      }
      el.value = value;
    }

    form.addEventListener("submit", (e) => {
      // Guard: URL missing
      if (!SCRIPT_URL || SCRIPT_URL.includes("PASTE_YOUR")){
        e.preventDefault();
        setStatus("Missing server URL. Paste your Apps Script Web App URL into voting.html.", "err");
        return;
      }

      ensureHidden("page", "voting");
      ensureHidden("timestamp", new Date().toISOString());
      ensureHidden("userAgent", navigator.userAgent);

      btn.disabled = true;
      btn.textContent = "Submitting…";
      setStatus("Submitting…");

      // We can't read the cross-origin response in the iframe,
      // so we show success UI after a short delay.
      setTimeout(() => {
        btn.disabled = false;
        btn.textContent = "Join mailing list";
        emailEl.value = "";
        setStatus("You’re on the list. We’ll remind you when voting opens.", "ok");
      }, 700);
    });
  </script>
</body>
</html>
