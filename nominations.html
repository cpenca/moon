<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Phase 1: Nominations</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="style.css">
  <style>
    /* --- Mobile-friendly overrides added on top of style.css --- */
    .wizard {
      width: 95%;
      max-width: 820px;
      margin: 1rem auto;
      padding: 1rem;
      border: 2px solid #ffd700;
      border-radius: 20px;
      box-shadow: 0 0 15px rgba(255,215,0,0.5);
      background: rgba(13,11,41,0.85);
      text-align: left;
    }
    .step-title { font-size: 1.15rem; margin: 0 0 0.75rem; }
    .q { display:flex; flex-direction:column; gap:0.5rem; margin:0.5rem 0 1rem; }
    .q input, .q textarea {
      padding: 0.9rem;
      border-radius: 12px;
      border: 1px solid #ffd700;
      background: transparent;
      color: #ffd700;
      font-size: 1rem;
      width: 100%;
      box-sizing: border-box;
    }
    .q textarea { min-height: 110px; }
    .controls { display:flex; gap:0.75rem; flex-wrap:wrap; margin-top: 1rem; }
    .btn {
      padding: 0.95rem 1.4rem;
      border: 2px solid #ffd700;
      border-radius: 22px;
      background: transparent;
      color: #ffd700; font-weight: 700; cursor: pointer; text-decoration: none;
      box-shadow: 0 0 8px rgba(255,215,0,0.4);
      transition: transform .2s, box-shadow .2s, background .2s;
      font-size: 1rem;
    }
    .btn:active { transform: scale(0.98); }
    .btn:hover { transform: scale(1.03); box-shadow: 0 0 15px rgba(255,215,0,0.8); background: rgba(255,215,0,0.12); }
    .progress { margin: 0.25rem 0 1rem; font-size: 0.95rem; opacity: 0.9; }
    .success,.error { margin-top:1rem; padding:0.9rem 1rem; border-radius:12px; background:rgba(0,0,0,0.25); }
    .success { border:1px solid #34d399; color:#b2f5ea; }
    .error { border:1px solid #f87171; color:#fecaca; }
    .two-col { display:grid; grid-template-columns: 1fr 1fr; gap: 0.75rem; }
    /* Force single-column on small screens for better readability */
    @media (max-width: 640px) {
      .two-col { grid-template-columns: 1fr; }
      .wizard { margin: 0.75rem auto; padding: 0.9rem; }
      .step-title { font-size: 1.1rem; }
      .btn { width: 100%; justify-content: center; }
      .controls { gap: 0.5rem; }
    }
    /* Hide honeypot off-screen (still accessible to bots) */
    .hp-wrap { position: absolute; left: -10000px; top: auto; width: 1px; height: 1px; overflow: hidden; }
  </style>
</head>
<body>
  <!-- Moon image -->
  <img src="moon2.png" alt="Full Moon" class="moon">

  <!-- Nav -->
  <nav>
    <a href="index.html">About</a>
    <a href="nominations.html">Phase 1: Nominations</a>
    <a href="voting.html">Phase 2: Voting</a>
  </nav>

  <main>
    <h1>Phase 1: Nominations</h1>
    <p>You can skip any question by tapping “Next”. You can also go back before submitting.</p>

    <div class="wizard" id="wizard">
      <div class="progress" id="progress">Step 1 of 15</div>

      <!-- Question area we replace -->
      <div id="step">
        <div class="step-title">1) What is your name?</div>
        <div class="q">
          <input id="name" type="text" placeholder="Your name (optional)" autocomplete="name">
          <div class="subtext">You can skip if you prefer.</div>
        </div>
      </div>

      <!-- Honeypot (bots will fill; humans won't see it) -->
      <div class="hp-wrap">
        <label>Website <input type="text" id="website" autocomplete="off"></label>
      </div>

      <div class="controls" id="controls">
        <button class="btn" id="backBtn" type="button" onclick="goBack()">← Back</button>
        <button class="btn" id="nextBtn" type="button" onclick="nextStep()">Next →</button>
        <button class="btn" id="submitBtn" type="button" style="display:none;" onclick="submitForm()">Submit</button>
      </div>

      <div id="result"></div>
    </div>

    <noscript>
      <p class="error">JavaScript is required to complete this form.</p>
    </noscript>
  </main>

  <script>
    /* ===== CONFIG ===== */
    var FORM_ENDPOINT = 'https://script.google.com/macros/s/AKfycbzeNpP7xO_6P85VUfzGpMnSfXXgkBU5ML55teNV8njQgjMxV9POBfZvgfczwATqp-TR8g/exec';

    /* ===== STATE ===== */
    var startTime = Date.now();
    var months = ['January','February','March','April','May','June',
                  'July','August','September','October','November','December'];

    var steps = []; // filled below
    var state = {
      name: '',
      email: '',
      months: months.map(function (m) { return { month: m, name: '', explanation: '' }; }),
      captchaAns: ''
    };
    var i = 0; // current step index (0..14)

    /* ===== BUILD STEPS ===== */
    steps.push({
      key: 'name',
      render: function () {
        return '' +
          '<div class="step-title">1) What is your name?</div>' +
          '<div class="q">' +
            '<input id="name" type="text" placeholder="Your name (optional)" autocomplete="name">' +
            '<div class="subtext">You can skip if you prefer.</div>' +
          '</div>';
      }
    });
    steps.push({
      key: 'email',
      render: function () {
        return '' +
          '<div class="step-title">2) What is your email address?</div>' +
          '<div class="q">' +
            '<input id="email" type="email" placeholder="you@example.com (optional)" autocomplete="email">' +
            '<div class="subtext">We’ll send you updates. You can skip.</div>' +
          '</div>';
      }
    });
    for (var mi = 0; mi < months.length; mi++) {
      (function(idx){
        steps.push({
          key: 'm' + idx,
          month: months[idx],
          render: function () {
            return '' +
              '<div class="step-title">' + (idx + 3) + ') ' + months[idx] + ': Suggest a name for the full moon</div>' +
              '<div class="two-col">' +
                '<div class="q"><input id="moonName" type="text" placeholder="Moon name (optional)"></div>' +
                '<div class="q"><textarea id="moonExplanation" placeholder="Brief, optional explanation"></textarea></div>' +
              '</div>' +
              '<div class="subtext">You can skip if you like.</div>';
          }
        });
      })(mi);
    }
    steps.push({
      key: 'captcha',
      render: function () {
        window._a = Math.floor(Math.random()*8)+2; // 2..9
        window._b = Math.floor(Math.random()*8)+2;
        return '' +
          '<div class="step-title">Last step: quick human check</div>' +
          '<div class="q">' +
            '<label for="captchaAns">What is <strong>' + window._a + ' + ' + window._b + '</strong>?</label>' +
            '<input id="captchaAns" type="number" inputmode="numeric" placeholder="Answer required to submit">' +
          '</div>' +
          '<div class="subtext">This helps prevent spam.</div>';
      }
    });

    /* ===== ELEMENTS ===== */
    var stepContainer = document.getElementById('step');
    var progressEl   = document.getElementById('progress');
    var backBtn      = document.getElementById('backBtn');
    var nextBtn      = document.getElementById('nextBtn');
    var submitBtn    = document.getElementById('submitBtn');
    var resultEl     = document.getElementById('result');
    var controlsWrap = document.getElementById('controls');

    /* ===== RENDER / COLLECT / REFILL ===== */
    function render() {
      stepContainer.innerHTML = steps[i].render();
      progressEl.textContent = 'Step ' + (i + 1) + ' of ' + steps.length;

      var onLast = (i === steps.length - 1);
      backBtn.style.visibility = (i === 0 ? 'hidden' : 'visible');
      nextBtn.style.display    = (onLast ? 'none' : 'inline-block');     // Next is skip/advance
      submitBtn.style.display  = (onLast ? 'inline-block' : 'none');     // Only on last step

      resultEl.innerHTML = '';
      refill();
    }

    function collectCurrentStep(saveEmpty) {
      var s = steps[i];
      if (s.key === 'name') {
        var el = document.getElementById('name');
        var v = (el ? el.value : '').trim();
        if (v || saveEmpty) state.name = v;
      } else if (s.key === 'email') {
        var el2 = document.getElementById('email');
        var v2 = (el2 ? el2.value : '').trim();
        if (v2 || saveEmpty) state.email = v2;
      } else if (s.month) {
        var n = document.getElementById('moonName');
        var e = document.getElementById('moonExplanation');
        var name = (n ? n.value : '').trim();
        var explanation = (e ? e.value : '').trim();
        var idx = months.indexOf(s.month);
        if (idx >= 0 && (name || explanation || saveEmpty)) {
          state.months[idx] = { month: s.month, name: name, explanation: explanation };
        }
      } else if (s.key === 'captcha') {
        var c = document.getElementById('captchaAns');
        state.captchaAns = (c ? c.value : '').trim();
      }
    }

    function refill() {
      var s = steps[i];
      if (s.key === 'name') {
        var el = document.getElementById('name'); if (el) el.value = state.name || '';
      } else if (s.key === 'email') {
        var el2 = document.getElementById('email'); if (el2) el2.value = state.email || '';
      } else if (s.month) {
        var idx = months.indexOf(s.month);
        var rec = state.months[idx] || {};
        var n = document.getElementById('moonName');
        var e = document.getElementById('moonExplanation');
        if (n) n.value = rec.name || '';
        if (e) e.value = rec.explanation || '';
      } else if (s.key === 'captcha') {
        var c = document.getElementById('captchaAns'); if (c) c.value = state.captchaAns || '';
      }
    }

    /* ===== BUTTON HANDLERS ===== */
    function goBack() {
      collectCurrentStep(true);
      i = Math.max(0, i - 1);
      render();
    }
    function nextStep() {
      // Next acts as skip: record what’s there (even if empty) and advance
      collectCurrentStep(true);
      i = Math.min(steps.length - 1, i + 1);
      render();
    }
    function submitForm() {
      collectCurrentStep(false);
      var website = document.getElementById('website') ? document.getElementById('website').value : '';
      var elapsedMs = Date.now() - startTime;

      // Require math answer
      var a = window._a, b = window._b, ans = Number(state.captchaAns);
      if (!isFinite(ans)) {
        resultEl.innerHTML = '<div class="error">❌ Please solve the quick math check.</div>';
        return;
      }

      var payload = {
        website: website,
        elapsedMs: elapsedMs,
        captcha: { a: a, b: b, ans: ans },
        name: state.name || '',
        email: state.email || '',
        months: state.months
      };

      // Disable buttons during submit
      backBtn.disabled = nextBtn.disabled = submitBtn.disabled = true;

      fetch(FORM_ENDPOINT, {
        method: 'POST',
        headers: { 'Content-Type': 'text/plain;charset=utf-8' }, // avoids preflight/CORS
        body: JSON.stringify(payload),
        mode: 'cors'
      })
      .then(function (res) { return res.json(); })
      .then(function (data) {
        if (data && data.ok) {
          // Hide question + buttons and show confirmation
          stepContainer.innerHTML = '';
          controlsWrap.style.display = 'none';
          resultEl.innerHTML = '<div class="success">✅ Thanks! Your nominations were recorded.</div>';
          progressEl.textContent = 'Done';
        } else {
          throw new Error((data && data.error) || 'Unknown error');
        }
      })
      .catch(function (err) {
        console.error(err);
        resultEl.innerHTML = '<div class="error">❌ Submission failed: ' + String(err) + '</div>';
      })
      .finally(function () {
        backBtn.disabled = nextBtn.disabled = submitBtn.disabled = false;
      });
    }

    // Expose for inline onclick
    window.goBack = goBack;
    window.nextStep = nextStep;
    window.submitForm = submitForm;

    // Initial render
    render();
  </script>
</body>
</html>
