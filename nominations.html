<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Phase 1: Nominations</title>
  <link rel="stylesheet" href="style.css">
  <style>
    .wizard {
      width: 100%; max-width: 820px; margin: 2rem auto; padding: 1.25rem;
      border: 2px solid #ffd700; border-radius: 20px;
      box-shadow: 0 0 15px rgba(255,215,0,0.5); background: rgba(13,11,41,0.85);
      text-align: left;
    }
    .step-title { font-size: 1.25rem; margin: 0 0 0.75rem; }
    .q { display:flex; flex-direction:column; gap:0.5rem; margin:0.5rem 0 1rem; }
    .q input, .q textarea { padding:0.8rem; border-radius:12px; border:1px solid #ffd700; background:transparent; color:#ffd700; }
    .q textarea { min-height:110px; }
    .controls { display:flex; gap:0.75rem; flex-wrap:wrap; margin-top:1rem; }
    .btn {
      padding:0.8rem 1.2rem; border:2px solid #ffd700; border-radius:22px; background:transparent;
      color:#ffd700; font-weight:700; cursor:pointer; text-decoration:none;
      box-shadow:0 0 8px rgba(255,215,0,0.4);
      transition: transform .2s, box-shadow .2s, background .2s;
    }
    .btn:hover { transform:scale(1.03); box-shadow:0 0 15px rgba(255,215,0,0.8); background:rgba(255,215,0,0.12); }
    .progress { margin:0.25rem 0 1rem; font-size:0.95rem; opacity:0.9; }
    .success,.error { margin-top:1rem; padding:0.8rem 1rem; border-radius:12px; background:rgba(0,0,0,0.25); }
    .success { border:1px solid #34d399; color:#b2f5ea; }
    .error { border:1px solid #f87171; color:#fecaca; }
    .two-col { display:grid; grid-template-columns:1fr; gap:0.75rem; }
    @media (min-width:640px){ .two-col{ grid-template-columns:1fr 1fr; } }
    .subtext { font-size: 0.9rem; opacity: 0.85; margin-top: -0.25rem; }
    .hp-wrap { position:absolute; left:-10000px; top:auto; width:1px; height:1px; overflow:hidden; } /* honeypot */
  </style>
</head>
<body>
  <!-- Moon image -->
  <img src="moon.png" alt="Full Moon" class="moon">

  <!-- Nav -->
  <nav>
    <a href="index.html">About</a>
    <a href="nominations.html">Phase 1: Nominations</a>
    <a href="voting.html">Phase 2: Voting</a>
  </nav>

  <main>
    <h1>Phase 1: Nominations</h1>
    <p>You can skip any question and return before submitting.</p>

    <div class="wizard" id="wizard">
      <div class="progress" id="progress">Step 1 of 15</div>

      <!-- Pre-rendered first step so fields are visible even if JS fails -->
      <div id="step">
        <div class="step-title">1) What is your name?</div>
        <div class="q">
          <input id="name" type="text" placeholder="Your name (optional)">
          <div class="subtext">You can skip if you prefer.</div>
        </div>
      </div>

      <!-- Honeypot (bots will fill; humans won't see it) -->
      <div class="hp-wrap">
        <label>Website <input type="text" id="website" autocomplete="off"></label>
      </div>

      <div class="controls">
        <button class="btn" id="backBtn" type="button">← Back</button>
        <button class="btn" id="skipBtn" type="button">Skip</button>
        <button class="btn" id="nextBtn" type="button">Next →</button>
        <button class="btn" id="submitBtn" type="button" style="display:none;">Submit</button>
      </div>

      <div id="result"></div>
    </div>

    <noscript>
      <p class="error">JavaScript is required to complete this form.</p>
    </noscript>
  </main>

  <script>
    (function () {
      // ====== CONFIG ======
      var FORM_ENDPOINT = 'https://script.google.com/macros/s/AKfycbzeNpP7xO_6P85VUfzGpMnSfXXgkBU5ML55teNV8njQgjMxV9POBfZvgfczwATqp-TR8g/exec';
      var startTime = Date.now();

      var months = ['January','February','March','April','May','June',
                    'July','August','September','October','November','December'];

      // Build steps array without optional chaining/spread quirks
      var steps = [];
      steps.push({
        key: 'name',
        render: function () {
          return '' +
            '<div class="step-title">1) What is your name?</div>' +
            '<div class="q">' +
              '<input id="name" type="text" placeholder="Your name (optional)">' +
              '<div class="subtext">You can skip if you prefer.</div>' +
            '</div>';
        }
      });
      steps.push({
        key: 'email',
        render: function () {
          return '' +
            '<div class="step-title">2) What is your email address?</div>' +
            '<div class="q">' +
              '<input id="email" type="email" placeholder="you@example.com (optional)">' +
              '<div class="subtext">We’ll send you updates. You can skip.</div>' +
            '</div>';
        }
      });
      for (var mi = 0; mi < months.length; mi++) {
        (function(idx){
          steps.push({
            key: 'm' + idx,
            month: months[idx],
            render: function () {
              return '' +
                '<div class="step-title">' + (idx + 3) + ') ' + months[idx] + ': Suggest a name for the full moon</div>' +
                '<div class="two-col">' +
                  '<div class="q"><input id="moonName" type="text" placeholder="Moon name (optional)"></div>' +
                  '<div class="q"><textarea id="moonExplanation" placeholder="Brief, optional explanation"></textarea></div>' +
                '</div>' +
                '<div class="subtext">You can skip if you like.</div>';
            }
          });
        })(mi);
      }
      steps.push({
        key: 'captcha',
        render: function () {
          window._a = Math.floor(Math.random()*8)+2; // 2..9
          window._b = Math.floor(Math.random()*8)+2;
          return '' +
            '<div class="step-title">Last step: quick human check</div>' +
            '<div class="q">' +
              '<label for="captchaAns">What is <strong>' + window._a + ' + ' + window._b + '</strong>?</label>' +
              '<input id="captchaAns" type="number" inputmode="numeric" placeholder="Answer required to submit">' +
            '</div>' +
            '<div class="subtext">This helps prevent spam.</div>';
        }
      });

      var state = {
        name: '',
        email: '',
        months: months.map(function (m) { return { month: m, name: '', explanation: '' }; }),
        captchaAns: ''
      };

      var i = 0;

      // Grab elements
      var stepContainer = document.getElementById('step');
      var progressEl   = document.getElementById('progress');
      var backBtn      = document.getElementById('backBtn');
      var skipBtn      = document.getElementById('skipBtn');
      var nextBtn      = document.getElementById('nextBtn');
      var submitBtn    = document.getElementById('submitBtn');
      var resultEl     = document.getElementById('result');

      function render() {
        // Render current step
        stepContainer.innerHTML = steps[i].render();
        // Update progress
        progressEl.textContent = 'Step ' + (i + 1) + ' of ' + steps.length;
        // Button visibility
        var onCaptcha = steps[i].key === 'captcha';
        backBtn.style.visibility = (i === 0 ? 'hidden' : 'visible');
        skipBtn.style.display    = (onCaptcha ? 'none' : 'inline-block');
        nextBtn.style.display    = (i < steps.length - 1 ? 'inline-block' : 'none');
        submitBtn.style.display  = (i === steps.length - 1 ? 'inline-block' : 'none');
        // Prefill values
        refill();
      }

      function collectCurrentStep(saveEmpty) {
        var s = steps
