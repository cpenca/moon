<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Nominations Form</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="style.css" />
</head>

<body class="page-nominations-form">
  <!-- Exit button -->
  <a class="exit-btn" href="nominations.html"
     onclick="if (history.length>1){history.back(); return false;}">⟵ Exit</a>

  <!-- Moon -->
  <header class="site-header">
    <img src="moon.png" alt="Full Moon" class="moon" />
  </header>

  <main class="container">
    <h1>Phase 1: Nominations</h1>
    <p class="intro">Pick a month (or Blue Moon) and submit your nomination.</p>

    <div class="wizard">
      <!-- Honeypot (hidden from humans, visible to bots) -->
      <div class="hp-wrap" aria-hidden="true">
        <label>Website
          <input type="text"
                 id="website"
                 name="website"
                 autocomplete="off"
                 tabindex="-1"
                 inputmode="text"
                 spellcheck="false">
        </label>
      </div>

      <form id="nominationForm" onsubmit="submitForm(event)">
        <div class="q">
          <label for="month"><strong>Month</strong></label>
          <select id="month" name="month" required>
            <option value="" disabled selected>Select a month</option>
            <option value="January">January</option>
            <option value="February">February</option>
            <option value="March">March</option>
            <option value="April">April</option>
            <option value="May">May</option>
            <option value="June">June</option>
            <option value="July">July</option>
            <option value="August">August</option>
            <option value="September">September</option>
            <option value="October">October</option>
            <option value="November">November</option>
            <option value="December">December</option>
            <option value="Blue Moon">Blue Moon</option>
          </select>
        </div>

        <div class="q">
          <label for="name"><strong>Your name</strong></label>
          <input id="name" name="name" type="text" placeholder="Optional" autocomplete="name">
        </div>

        <div class="q">
          <label for="zip"><strong>ZIP code</strong></label>
          <input id="zip" name="zip" type="text" required placeholder="example 33133" autocomplete="postal-code">
        </div>

        <div class="q">
          <label for="email"><strong>Email address</strong></label>
          <input id="email" name="email" type="text" required autocomplete="email">
        </div>

        <div class="q">
          <label for="moonName"><strong>Moon name suggestion</strong></label>
          <input id="moonName" name="moonName" type="text" required>
        </div>

        <div class="q">
          <label for="explanation"><strong>Brief explanation</strong></label>
          <textarea id="explanation" name="explanation" required></textarea>
        </div>

        <div class="controls" id="controls">
          <button class="btn" id="submitBtn" type="submit">Submit</button>
        </div>

        <div id="result"></div>
      </form>
    </div>
  </main>

  <script>
    /* ===== CONFIG ===== */
    var FORM_ENDPOINT =
      'https://script.google.com/macros/s/AKfycbwEOkhxRFzDQKSuztQG-qAVxzaFdhcjlGWTxt44TVq6Pmrk98oOVe5ut4Tm_5eLeNt68A/exec';

    /* ===== STATE ===== */
    var startTime = Date.now();

    function submitForm(e) {
      e.preventDefault();

      var website = document.getElementById('website')?.value || '';
      var elapsedMs = Date.now() - startTime;

      var month = (document.getElementById('month')?.value || '').trim();
      var name = (document.getElementById('name')?.value || '').trim();
      var zip = (document.getElementById('zip')?.value || '').trim();
      var email = (document.getElementById('email')?.value || '').trim();
      var moonName = (document.getElementById('moonName')?.value || '').trim();
      var explanation = (document.getElementById('explanation')?.value || '').trim();

      if (!month || !zip || !email || !moonName || !explanation) {
        document.getElementById('result').innerHTML =
          '<div class="error">❌ Please complete all required fields.</div>';
        return;
      }

      var payload = {
        website: website,
        elapsedMs: elapsedMs,
        name: name,
        zip: zip,
        email: email,
        month: month,
        moonName: moonName,
        explanation: explanation
      };

      var submitBtn = document.getElementById('submitBtn');
      var resultEl = document.getElementById('result');

      submitBtn.disabled = true;
      resultEl.innerHTML = '';

      fetch(FORM_ENDPOINT, {
        method: 'POST',
        headers: { 'Content-Type': 'text/plain;charset=utf-8' },
        body: JSON.stringify(payload),
        mode: 'no-cors'
      })
      .then(function () {
        resultEl.innerHTML = '<div class="success">✅ Thanks! Your nomination was sent.</div>';
        document.getElementById('nominationForm').reset();
        startTime = Date.now();
      })
      .catch(function(err){
        console.error(err);
        resultEl.innerHTML =
          '<div class="error">❌ Submission failed: ' + String(err) + '</div>';
      })
      .finally(function(){
        submitBtn.disabled = false;
      });
    }
  </script>
</body>
</html>
